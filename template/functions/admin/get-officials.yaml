GetOfficialsFunction:
  Type: AWS::Serverless::Function
  Properties:
    CodeUri: lambda/GetOfficialsFunction
    Handler: handler.default
    Layers:
      - !Ref CommonLayer
    Tracing: Active
    Policies:
      - Statement:
          - Sid: SSMGetParameterPolicy
            Effect: Allow
            Action:
              - ssm:GetParameters
              - ssm:GetParameter
            Resource: '*'
      - DynamoDBCrudPolicy:
          TableName: !Ref OfficialTable
      - DynamoDBReadPolicy:
          TableName: !Ref EventTypeTable
      # Needed by updateUsersFromOfficialsOrJudges(): rewrites event.official/event.secretary references
      # after merging duplicate users (kcId stable, KL email may change).
      - DynamoDBCrudPolicy:
          TableName: !Ref EventTable
      - DynamoDBCrudPolicy:
          TableName: !Ref UserTable
      - DynamoDBReadPolicy:
          TableName: !Ref UserLinkTable
      - DynamoDBCrudPolicy:
          TableName: !Ref AuditTable
      - CloudWatchPutMetricPolicy: {}
    Events:
      GetOfficials:
        Type: Api
        Properties:
          Path: /admin/official
          Method: GET
          RestApiId: !Ref KoekalenteriApi
          Auth:
            Authorizer: CognitoAuthorizer

GetOfficialsFunctionLogGroup:
  Type: AWS::Logs::LogGroup
  Properties:
    LogGroupName: !Join ['/', ['/aws/lambda', !Ref GetOfficialsFunction]]
    RetentionInDays: 30
